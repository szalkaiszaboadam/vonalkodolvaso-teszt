<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vonalk√≥d Olvas√≥ + L√°mpa</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h1 { margin-bottom: 10px; }

        /* A kamera doboza */
        #reader {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            border-radius: 8px;
            overflow: hidden;
            background: #000;
        }

        /* Az eredm√©ny doboza */
        #result-box {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 1.2rem;
        }

        #scanned-result {
            font-weight: bold;
            color: #2a9d8f;
        }

        /* Zsebl√°mpa gomb st√≠lusa */
        #torch-btn {
            margin-top: 15px;
            padding: 15px 30px;
            font-size: 18px;
            background-color: #e76f51;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            display: none; /* Alapb√≥l elrejtj√ºk, am√≠g a kamera el nem indul */
        }
        #torch-btn:active { transform: scale(0.98); }
        #torch-btn.active { background-color: #f4a261; border: 2px solid #e76f51; }
    </style>
</head>
<body>

    <h1>Vonalk√≥d Szkenner</h1>

    <div id="reader"></div>

    <button id="torch-btn" onclick="toggleTorch()">üî¶ L√°mpa Be/Ki</button>

    <div id="result-box">
        Beolvasott k√≥d: <br>
        <span id="scanned-result">- m√©g nincs -</span>
    </div>

    <script>
        let html5QrCode;
        let isTorchOn = false;

        function startScanner() {
            // L√©trehozzuk a scanner p√©ld√°nyt
            html5QrCode = new Html5Qrcode("reader");

            const config = {
                fps: 10,  // K√©pkocka / m√°sodperc (ne legyen t√∫l magas a teljes√≠tm√©ny miatt)
                qrbox: { width: 250, height: 250 } // A szkennel√©si n√©gyzet m√©rete
            };

            // Ind√≠t√°s a h√°ts√≥ kamer√°val ('environment')
            html5QrCode.start(
                { facingMode: "environment" },
                config,
                onScanSuccess
            ).then(() => {
                // Ha sikeresen elindult a kamera, megjelen√≠tj√ºk a l√°mpa gombot
                document.getElementById("torch-btn").style.display = "inline-block";
                console.log("Kamera elindult.");
            }).catch(err => {
                console.error("Hiba a kamera ind√≠t√°sakor:", err);
                alert("Nem siker√ºlt elind√≠tani a kamer√°t. Ellen≈ërizd a jogosults√°gokat √©s a HTTPS kapcsolatot!");
            });
        }

        // Ez fut le, ha sikeres a beolvas√°s
        function onScanSuccess(decodedText, decodedResult) {
            // Ki√≠rjuk az eredm√©nyt a k√©perny≈ëre
            document.getElementById('scanned-result').innerText = decodedText;

            // Opcion√°lis: pittyeghet, vagy le√°ll√≠thatjuk a kamer√°t beolvas√°s ut√°n
            // html5QrCode.stop();
        }

        // Zsebl√°mpa kapcsolgat√°sa
        function toggleTorch() {
            if (!html5QrCode) return;

            // Ellen≈ërizz√ºk az aktu√°lis √°llapotot √©s ford√≠tjuk
            isTorchOn = !isTorchOn;

            // A constraint be√°ll√≠t√°sa a vakuhoz
            const constraints = {
                advanced: [{ torch: isTorchOn }]
            };

            html5QrCode.applyVideoConstraints(constraints)
                .then(() => {
                    console.log("L√°mpa √°llapot: " + isTorchOn);
                    const btn = document.getElementById("torch-btn");
                    btn.innerText = isTorchOn ? "üî¶ L√°mpa KI" : "üî¶ L√°mpa BE";
                })
                .catch(err => {
                    console.error("A l√°mpa kapcsol√°sa nem siker√ºlt: ", err);
                    alert("A te k√©sz√ºl√©ked vagy b√∂ng√©sz≈ëd nem t√°mogatja a l√°mpa vez√©rl√©s√©t ezen a m√≥don.");
                    isTorchOn = !isTorchOn; // Vissza√°ll√≠tjuk a v√°ltoz√≥t, ha hiba volt
                });
        }

        // Az oldal bet√∂lt√©sekor ind√≠tjuk
        window.onload = startScanner;
    </script>
</body>
</html>